(()=>{var t={426:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});var i=n(645),o=n.n(i)()((function(t){return t[1]}));o.push([t.id,"main {\n    position: absolute;\n    left: 0;\n    top: 0;\n    margin: 0;\n    width: 100%;\n    height: 100%;\n    background-color: antiquewhite;\n    padding: 10px;\n    font-family: 'Courier New', Courier, monospace;\n    box-sizing: border-box;\n}\n\nmain.hidden {\n    display: none;\n}\n\nmain nav {\n    display: flex;\n    justify-content: space-around;\n}\n\nmain nav p {\n    margin: 0;\n}\n\nmain figure {\n    width: 100%;\n    height: 100%;\n    margin: 0;\n    max-height: 95vh;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    position: relative;\n    box-sizing: border-box;\n}\n\nmain figure canvas {\n    box-sizing: border-box;\n    max-height: inherit;\n    margin: 0 5px;\n    cursor: crosshair;\n}\n\nmain figure figcaption {\n    pointer-events: none;\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%, -50%);\n\n    border: 3px double white;\n    border-radius: 2em;\n    padding: 1em;\n    \n    color: white;\n    background: black;\n}\n\nmain figure figcaption p {\n    margin: 0;\n}\n\n",""]);const r=o},645:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=t(e);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,i){"string"==typeof t&&(t=[[null,t,""]]);var o={};if(i)for(var r=0;r<this.length;r++){var a=this[r][0];null!=a&&(o[a]=!0)}for(var s=0;s<t.length;s++){var l=[].concat(t[s]);i&&o[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),e.push(l))}},e}},379:(t,e,n)=>{"use strict";var i,o=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}(),r=[];function a(t){for(var e=-1,n=0;n<r.length;n++)if(r[n].identifier===t){e=n;break}return e}function s(t,e){for(var n={},i=[],o=0;o<t.length;o++){var s=t[o],l=e.base?s[0]+e.base:s[0],u=n[l]||0,c="".concat(l," ").concat(u);n[l]=u+1;var d=a(c),h={css:s[1],media:s[2],sourceMap:s[3]};-1!==d?(r[d].references++,r[d].updater(h)):r.push({identifier:c,updater:y(h,e),references:1}),i.push(c)}return i}function l(t){var e=document.createElement("style"),i=t.attributes||{};if(void 0===i.nonce){var r=n.nc;r&&(i.nonce=r)}if(Object.keys(i).forEach((function(t){e.setAttribute(t,i[t])})),"function"==typeof t.insert)t.insert(e);else{var a=o(t.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(e)}return e}var u,c=(u=[],function(t,e){return u[t]=e,u.filter(Boolean).join("\n")});function d(t,e,n,i){var o=n?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(t.styleSheet)t.styleSheet.cssText=c(e,o);else{var r=document.createTextNode(o),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(r,a[e]):t.appendChild(r)}}function h(t,e,n){var i=n.css,o=n.media,r=n.sourceMap;if(o?t.setAttribute("media",o):t.removeAttribute("media"),r&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}var f=null,p=0;function y(t,e){var n,i,o;if(e.singleton){var r=p++;n=f||(f=l(e)),i=d.bind(null,n,r,!1),o=d.bind(null,n,r,!0)}else n=l(e),i=h.bind(null,n,e),o=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else o()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=(void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i));var n=s(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var i=0;i<n.length;i++){var o=a(n[i]);r[o].references--}for(var l=s(t,e),u=0;u<n.length;u++){var c=a(n[u]);0===r[c].references&&(r[c].updater(),r.splice(c,1))}n=l}}}},633:t=>{function e(){}e.prototype={on:function(t,e,n){var i=this.e||(this.e={});return(i[t]||(i[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){var i=this;function o(){i.off(t,o),e.apply(n,arguments)}return o._=e,this.on(t,o,n)},emit:function(t){for(var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),i=0,o=n.length;i<o;i++)n[i].fn.apply(n[i].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),i=n[t],o=[];if(i&&e)for(var r=0,a=i.length;r<a;r++)i[r].fn!==e&&i[r].fn._!==e&&o.push(i[r]);return o.length?n[t]=o:delete n[t],this}},t.exports=e,t.exports.TinyEmitter=e}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var r=e[i]={id:i,exports:{}};return t[i](r,r.exports,n),r.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t={};n.r(t),n.d(t,{_360deg:()=>o,_90deg:()=>i,areCircleAndPolygonIntersecting:()=>b,areCirclesIntersecting:()=>x,arePolygonsIntersecting:()=>w,closestpointonline:()=>v,doLineSegmentsIntersect:()=>S,findIntersectionPointOfLineSegments:()=>k,getCircleTangentAtPoint:()=>d,getDirection:()=>s,getDistanceBetweenPoints:()=>u,getHeadingFromPointToPoint:()=>c,getMagnitude:()=>l,getPolygonLineSegments:()=>a,getVectorX:()=>h,getVectorY:()=>f,getXYVector:()=>p,isPointInsidePolygon:()=>P,normaliseHeading:()=>C,reflectHeading:()=>M,reverseHeading:()=>O,translatePoint:()=>y});var e=Math.pow(10,30),i=.5*Math.PI,o=2*Math.PI,r={x:0,y:0};function a(t){for(var e=[],n=0;n<t.length;n++)e.push([t[n],n+1>=t.length?t[0]:t[n+1]]);return e}function s(t,e){if(0==t&&0==e)return 0;if(0!=e&&0!=t){if(e>0)return Math.atan(t/e);if(e<0)return Math.PI+Math.atan(t/e)}return 0==e&&0!=t?t<0?1.5*Math.PI:.5*Math.PI:0==t&&0!=e?e>0?0:1*Math.PI:void 0}function l(t,e){return Math.sqrt(t*t+e*e)}function u(t,e){return e||(e=r),l(t.x-e.x,t.y-e.y)}function c(t,e){return s(t.x-e.x,t.y-e.y)}function d(t,e){var n=c(t,e)+.5*Math.PI;return n>2*Math.PI&&(n-=2*Math.PI),n}function h(t,e){return t*Math.sin(e)}function f(t,e){return t*Math.cos(e)}function p(t,e){return{x:h(t,e),y:f(t,e)}}function y(t,e,n){void 0===n&&(n=!1);var i=n?-1:1;return{x:t.x+i*e.x,y:t.y+i*e.y}}function m(t,e,n,i){return{x:(1-t)*n.x+t*i.x-e.x,y:(1-t)*n.y+t*i.y-e.y}}function g(t){return Math.pow(t.x,2)+Math.pow(t.y,2)}function v(t,e,n){if(!isFinite(e.x)&&!isFinite(e.y))return console.log("bad L2 passed to closestpointonline, returning L1 coords"),{x:t.x,y:t.y};var i=e.y-t.y,o=t.x-e.x,r=(e.y-t.y)*t.x+(t.x-e.x)*t.y,a=-o*n.x+i*n.y,s=i*i- -o*o,l=0,u=0;return 0!==s?(l=(i*r-o*a)/s,u=(i*a- -o*r)/s):(l=n.x,u=n.y),isFinite(l)&&isFinite(u)||(console.log("closestpointonline error"),console.log(t,e,n)),{x:l,y:u}}function x(t,e){return u(t,e)<t.radius+e.radius}function b(t,e){for(var n,i,o,a,s,l,c,d=!1,h=0;h<e.length;h++)if(n=e[h],o=t,void 0,void 0,void 0,void 0,a={x:(i=h+1>=e.length?e[0]:e[h+1]).x-n.x,y:i.y-n.y},s=n.x-o.x,l=n.y-o.y,u((c=-(a.x*s+a.y*l)/(Math.pow(a.x,2)+Math.pow(a.y,2)))>=0&&c<=1?m(c,r,n,i):g(m(0,o,n,i))<=g(m(1,o,n,i))?n:i,t)<=t.radius){d=!0;break}return!!d||P(t,e)}function w(t,e){var n,i,o=a(t),r=a(e);for(n=0;n<o.length;n++)for(i=0;i<r.length;i++)if(S(o[n],r[i]))return console.log("polygon edges intersect",o[n],r[i]),!0;for(n=0;n<t.length;n++)if(P(t[n],e))return console.log("polygon vertex inside other polygon",t[n]),!0;for(n=0;n<e.length;n++)if(P(e[n],t))return console.log("polygon vertex inside other polygon",e[n]),!0;return!1}function P(t,n){if(n.length<3)return!1;for(var i={y:t.y,x:e},o=0,r=0;r<n.length;r++)S([t,i],[n[r],r+1>=n.length?n[0]:n[r+1]])&&o++;return o%2!=0}function C(t){return t>o?t%o:(t<o&&(t%=o),t<0&&(t+=o),t)}function O(t){var e=t+Math.PI;return e>2*Math.PI&&(e-=2*Math.PI),e}function M(t,e){var n=2*e-t;return n<0*Math.PI&&(n+=2*Math.PI),n>2*Math.PI&&(n-=2*Math.PI),n===t&&(n=O(n)),n}function S(t,e){function n(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function i(t,e,n){var i=(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y);return 0==i?0:i>0?1:2}var o=i(t[0],t[1],e[0]),r=i(t[0],t[1],e[1]),a=i(e[0],e[1],t[0]),s=i(e[0],e[1],t[1]);return o!=r&&a!=s||!(0!=o||!n(t[0],e[0],t[1]))||!(0!=r||!n(t[0],e[1],t[1]))||!(0!=a||!n(e[0],t[0],e[1]))||!(0!=s||!n(e[0],t[1],e[1]))}function k(t,e){if(!S(t,e))return null;var n=(t[0].y-t[1].y)/(t[0].x-t[1].x),i=(e[0].y-e[1].y)/(e[0].x-e[1].x);if(n==i){var o=isFinite(n)?[t[0],t[1],e[0],e[1]].sort((function(t,e){return t.x-e.x})):[t[0],t[1],e[0],e[1]].sort((function(t,e){return t.y-e.y}));return{x:(o[1].x+o[2].x)/2,y:(o[1].y+o[2].y)/2}}if(isFinite(n)&&isFinite(i)){var r=t[0].y-n*t[0].x,a=(e[0].y-i*e[0].x-r)/(n-i);return{x:a,y:n*a+r}}return isFinite(n)&&!isFinite(i)?s(t,e):isFinite(i)&&!isFinite(n)?s(e,t):null;function s(t,e){var n=e[0].x,i=(t[0].y-t[1].y)/(t[0].x-t[1].x);return{x:n,y:i*n+(t[0].y-i*t[0].x)}}}var E=function(){function t(t,e){this.magnitude=t,this.direction=e}return Object.defineProperty(t.prototype,"vectorX",{get:function(){return h(this.magnitude,this.direction)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vectorY",{get:function(){return f(this.magnitude,this.direction)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vector",{get:function(){return{x:this.vectorX,y:this.vectorY}},enumerable:!1,configurable:!0}),t.fromVector=function(e,n){return new t(l(e,n),s(e,n))},t.combine=function(e){var n=0,i=0;return e.forEach((function(t){n+=t.vectorX,i+=t.vectorY})),new t(l(n,i),s(n,i))},Object.defineProperty(t,"none",{get:function(){return new t(0,0)},enumerable:!1,configurable:!0}),t}();function _(t,e){var n=e.fillColor,i=e.strokeColor,o=e.lineDash,r=void 0===o?[]:o,a=e.lineWidth,s="object"==typeof n?n.fallbackColor:n;t.beginPath(),t.setLineDash(r),t.fillStyle=s,t.strokeStyle=i,t.lineWidth=a||1}var T,j=function(t,e,n,i){_(t,n),"object"==typeof n.fillColor&&n.fillColor.setFillStyleForCircle(e,n.heading||0,t,i);var o=n.parallax,r=void 0===o?1:o,a=e.radius,s=i.mapPoint(e,r);t.arc(s.x,s.y,a*i.magnify/r,0,2*Math.PI),n.fillColor&&t.fill(),n.strokeColor&&t.stroke()},F=function(t,e,n,o){_(t,n),"object"==typeof n.fillColor&&n.fillColor.setFillStyleForCircle(e,n.heading||0,t,o);var r=n.parallax,a=void 0===r?1:r,s=e.radius,l=e.heading,u=e.angle,c=l-u/2+o.rotate,d=l+u/2+o.rotate,h=y(e,p(s,c)),f=y(e,p(s,d)),m=o.mapPoint(e,a),g=o.mapPoint(h,a),v=o.mapPoint(f,a),x=s*o.magnify/a,b=i-c,w=b-u;t.moveTo(m.x,m.y),t.lineTo(g.x,g.y),t.moveTo(m.x,m.y),t.arc(m.x,m.y,x,b,w,!0),t.moveTo(v.x,v.y),t.lineTo(m.x,m.y),n.fillColor&&t.fill(),n.strokeColor&&t.stroke()},I=function(t,e,n,i){_(t,n),"object"==typeof n.fillColor&&n.fillColor.setFillStyleForPolygon(e,n.heading||0,t,i);var o=n.parallax,r=void 0===o?1:o,a=e.map((function(t){return i.mapPoint(t,r)}));t.moveTo(a[0].x,a[0].y);for(var s=1;s<e.length;s++)t.lineTo(a[s].x,a[s].y);t.lineTo(a[0].x,a[0].y),n.fillColor&&t.fill(),n.strokeColor&&t.stroke()},V=function(){function e(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.magnify=t.magnify||1,this.rotate=t.rotate||0,this.dontRenderBackground=t.dontRenderBackground||!1,this.dontRenderEffects=t.dontRenderEffects||!1,this.transformRules=t.transformRules||[],this.framefill=t.framefill||"transparent",this.canvas=t.canvas,this.renderCanvas=this.renderCanvas.bind(this),t.world&&this.setWorld(t.world)}return Object.defineProperty(e.prototype,"visibleLineWidth",{get:function(){return 3*this.pointRadius},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointRadius",{get:function(){return Math.ceil(this.canvas.width/this.canvas.offsetWidth)},enumerable:!1,configurable:!0}),e.prototype.setWorld=function(t,e){void 0===e&&(e=!1),this.world&&this.unsetWorld(),this.world=t,this.world.emitter.on("tick",this.renderCanvas),e&&this.renderCanvas()},e.prototype.unsetWorld=function(){this.world.emitter.off("tick",this.renderCanvas),this.world=null},e.prototype.mapPoint=function(t,e){void 0===e&&(e=1);var n=this,i=n.x,o=n.y,r=n.magnify,a=n.width,s=n.height,l=n.rotate,u=E.fromVector(r/e*(i-t.x),r/e*(o-t.y));return u.direction+=l,{x:a/2-u.vectorX,y:s/2-u.vectorY}},e.prototype.unMapPoint=function(t,e){void 0===e&&(e=1);var n=this,i=n.x,o=n.y,r=n.magnify,a=n.width,s=n.height,l=n.rotate,u=E.fromVector(a/2-t.x,s/2-t.y);return u.direction-=l,{x:i-u.vectorX/(r/e),y:o-u.vectorY/(r/e)}},e.prototype.locateClick=function(t,e){void 0===e&&(e=!1);var n=this.canvas,i=n.getBoundingClientRect(),o=t.clientX-i.left-n.clientLeft,r=t.clientY-i.top-n.clientTop,a=o*(this.width/n.width),s=r*(this.height/n.height);return!e&&(a<0||s<0||a>this.width||s>this.height)?null:this.unMapPoint({x:a,y:s})},Object.defineProperty(e.prototype,"worldCorners",{get:function(){return[{x:0,y:0},{x:this.world.width,y:0},{x:this.world.width,y:this.world.height},{x:0,y:this.world.height}]},enumerable:!1,configurable:!0}),e.prototype.focusOn=function(t,e,n){if(void 0===e&&(e=!1),n&&(this.magnify=n),this.x=t.x,this.y=t.y,e){var i=this.height/(2*this.magnify),o=this.width/(2*this.magnify);this.y=Math.max(Math.min(t.y,this.world.height-i),i),this.x=Math.max(Math.min(t.x,this.world.width-o),o)}return this},e.prototype.reset=function(){if(this.world)return this.x=this.world.width/2,this.y=this.world.height/2,this.height=this.world.height,this.width=this.world.width,this.magnify=1,this.renderCanvas(),this},e.prototype.renderCanvas=function(){var e=this,n=this,o=n.world,r=n.canvas,s=n.cameraInstruction,l=n.transformRules,u=n.worldCorners;if(r&&(r.setAttribute("height",this.height.toString()),r.setAttribute("width",this.width.toString()),o)){s&&s.focusViewPort(this);var d=r.getContext("2d");"string"==typeof this.framefill?d.fillStyle=this.framefill:this.framefill.setFillStyleForViewPort(d,this),d.fillRect(0,0,this.canvas.width,this.canvas.height),I(d,u,{fillColor:"black"},this),this.dontRenderBackground||o.backGrounds.forEach((function(t){return t.renderOnCanvas(d,e)})),o.fluids.forEach((function(t){t.renderOnCanvas(d,e)})),o.bodies.forEach((function(t){var n=l.filter((function(e){return e.test(t)}))[0];n?n.renderOnCanvas(t,d,e):t.renderOnCanvas(d,e)})),this.dontRenderEffects||o.effects.forEach((function(t){t.renderOnCanvas(d,e)})),"string"==typeof this.framefill?d.fillStyle=this.framefill:this.framefill.setFillStyleForViewPort(d,this),d.lineWidth=0,d.strokeStyle="transparent",a(u.map((function(t){return e.mapPoint(t)}))).forEach((function(n){var o=c.apply(t,n),r=2*(e.width+e.height),a=p(r,o),s=p(r,o-i);d.beginPath(),d.moveTo(n[0].x+a.x,n[0].y+a.y),d.lineTo(n[1].x,n[1].y),d.lineTo(n[1].x+s.x,n[1].y+s.y),d.lineTo(n[0].x+s.x+a.x,n[0].y+s.y+a.y),d.lineTo(n[0].x+a.x,n[0].y+a.y),d.stroke(),d.fill()}))}},e.full=function(t,n,i){return void 0===i&&(i=1),new e({world:t,canvas:n,x:t.width/2,y:t.height/2,magnify:i,width:t.width*i,height:t.height*i})},e.fitToSize=function(t,n,i,o){return new e({world:t,canvas:n,height:o,width:i,x:t.width/2,y:t.height/2,magnify:Math.min(i/t.width,o/t.height)})},e}(),A=n(633),L=(T=function(t,e){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}T(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),W=function(t){this.startTime=Date.now(),this.bodyCount=t,this.collisionCount=0,this.collisionTestCount=0,this.edgeCollisionTestCount=0,this.calculationTime=0},z=function(t){function e(e,n){void 0===n&&(n={});var i=t.call(this)||this;i.timerSpeed=0,i.name=n.name||"",i.width=n.width||1e3,i.height=n.height||1e3,i.gravitationalConstant=n.gravitationalConstant||0,i.minimumMassToExertGravity=n.minimumMassToExertGravity||0,i.airDensity=n.airDensity||0,i.globalGravityForce=n.globalGravityForce||null,i.bodiesExertGravity=n.bodiesExertGravity||!1,i.hasHardEdges=n.hasHardEdges||!1;var o=e.filter((function(t){return t.isBody})),r=e.filter((function(t){return t.isFluid}));return i.bodies=[],o.forEach((function(t){t.enterWorld(i)})),i.effects=[],n.effects&&n.effects.forEach((function(t){t.enterWorld(i)})),i.backGrounds=n.backGrounds||[],i.fluids=[],r.forEach((function(t){return t.enterWorld(i)})),i.bodiesLeavingAtNextTick=[],i.emitter=new A.TinyEmitter,i}return L(e,t),Object.defineProperty(e.prototype,"report",{get:function(){return"The local gravity is "+this.gravitationalConstant.toFixed(2)+". Time runs at "+this.ticksPerSecond+" hertz. There are "+this.bodies.length+" bodies."},enumerable:!1,configurable:!0}),e.prototype.tick=function(){var t=this,e=this,n=e.fluids,i=e.effects,o=e.bodies,r=new W(this.bodies.length);this.bodiesLeavingAtNextTick.forEach((function(e){-1!==t.bodies.indexOf(e)&&(t.bodies.splice(t.bodies.indexOf(e),1),e.world=null)})),this.bodiesLeavingAtNextTick=[],n.forEach((function(t){return t.drain()}));var a=o.filter((function(t){return!t.data.immobile}));a.forEach((function(t){t.updateMomentum()})),a.filter((function(e){return e.world==t})).forEach((function(t){var e=t.detectCollisions(!1,!0),n=e.filter((function(t){return null!==t}));n.forEach((function(e){return t.handleCollision(e)})),r.collisionCount+=n.length,r.collisionTestCount+=e.length})),a.filter((function(e){return e.world==t})).forEach((function(t){var e=t.detectCollisions(!0,!1),n=e.filter((function(t){return null!==t}));n.forEach((function(e){return t.handleCollision(e)})),r.collisionCount+=n.length,r.collisionTestCount+=e.length})),this.hasHardEdges&&a.filter((function(e){return e.world==t})).forEach((function(t){var e=t.detectWorldEdgeCollisions(),n=e.filter((function(t){return null!==t}));r.edgeCollisionTestCount+=e.length,n.forEach((function(e){return t.handleWorldEdgeCollision(e)}))})),a.filter((function(e){return e.world==t})).forEach((function(t){t.move()})),this.backGrounds.forEach((function(t){return t.tick()})),i.forEach((function(t){return t.tick()})),r.calculationTime=Date.now()-r.startTime,this.emitter.emit("tick",r)},Object.defineProperty(e.prototype,"ticksPerSecond",{get:function(){return this.timerSpeed},set:function(t){if(0==t)return clearInterval(this.timer),void(this.timerSpeed=0);0!==this.timerSpeed&&clearInterval(this.timer);var e=this.tick.bind(this);this.timerSpeed=t,this.timer=setInterval(e,1e3/t)},enumerable:!1,configurable:!0}),e.prototype.stopTime=function(){return clearInterval(this.timer),this.timerSpeed=0,this},Object.defineProperty(e,"TickReport",{get:function(){return W.prototype},enumerable:!1,configurable:!0}),e}((function(){}));function D(t){var e=t.item1,n=t.item2,i=t.impactPoint,o="number"==typeof t.wallAngle?t.wallAngle:d(n.shapeValues,i);return new E(e.momentum.magnitude*(e.data.elasticity+n.data.elasticity)/2,M(e.momentum.direction,o))}function B(t){var e=t.item1.data.shape.id+"-"+t.item2.data.shape.id;switch(e){case"circle-circle":return function(t){if(function(t){var e=t.item1,n=t.item2,i=t.stopPoint;e.data.x=i.x,e.data.y=i.y;var o=e.shapeValues,r=n.shapeValues;if(e.isIntersectingWith(n)){var a=1+o.radius+r.radius-u(o,r),s=E.fromVector(o.x-r.x,o.y-r.y).direction,l=new E(a,s).vector;n.data.immobile?(e.data.x+=l.x,e.data.y+=l.y):(e.data.x+=l.x/2,e.data.y+=l.y/2,n.data.x-=l.x/2,n.data.y-=l.y/2)}}(t),t.item2.data.immobile)t.item1.momentum=D(t);else{var e=function(t){var e=t.item1,n=t.item2,i={x:n.shapeValues.x-e.shapeValues.x,y:n.shapeValues.y-e.shapeValues.y,mag:0};i.mag=u(i);var o={x:i.x/i.mag,y:i.y/i.mag},r=-o.y,a=o.x,s=e.momentum.vector,l=n.momentum.vector,c=o.x*s.x+o.y*s.y,d=r*s.x+a*s.y,h=o.x*l.x+o.y*l.y,f=d,p=r*l.x+a*l.y,y=(c*(e.mass-n.mass)+2*n.mass*h)/(e.mass+n.mass),m=(h*(n.mass-e.mass)+2*e.mass*c)/(e.mass+n.mass),g={x:y*o.x+f*r,y:y*o.y+f*a},v={x:m*o.x+p*r,y:m*o.y+p*a},x=(e.data.elasticity+n.data.elasticity)/2;return g.x=g.x*x,g.y=g.y*x,v.x=v.x*x,v.y=v.y*x,{vector1:g,vector2:v}}(t);t.item1.momentum=E.fromVector(e.vector1.x,e.vector1.y),t.item2.momentum=E.combine([E.fromVector(e.vector2.x,e.vector2.y),t.item2.momentum])}}(t);case"circle-square":return function(t){if(t.item2.data.immobile){var e=t.item1.duplicate();e.data.x=t.stopPoint.x,e.data.y=t.stopPoint.y,e.isIntersectingWith(t.item2)&&"start inside"!=t.type||(t.item1.data.x=t.stopPoint.x,t.item1.data.y=t.stopPoint.y),"start inside"!=t.type&&(t.item1.momentum=D(t))}else console.warn("Unhandled circle-mobile square collision",t)}(t);case"square-circle":return function(t){if(t.item2.data.immobile){console.warn(" square -> immobile-square collision(not handled right)",t);var e=t.item1.duplicate();e.data.x=t.stopPoint.x,e.data.y=t.stopPoint.y,e.isIntersectingWith(t.item2)&&"start inside"!=t.type||(t.item1.data.x=t.stopPoint.x,t.item1.data.y=t.stopPoint.y),"start inside"!=t.type&&(t.item1.momentum=D(t))}else console.warn("Unhandled square -> mobile-square collision",t)}(t);case"square-square":default:return void console.log("Unhandled "+e+" collision",t)}}var G,H=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),q=function(t,e){for(var n=0,i=e.length,o=t.length;n<i;n++,o++)t[o]=e[n];return t};function N(e,n){var i=a(n).map((function(t){var n=v(t[0],t[1],e);return{edge:t,point:n,distance:u(n,e),edgeAngle:0}})).sort((function(t,e){return t.distance-e.distance}))[0];return i.edgeAngle=c.apply(t,i.edge),i}function R(t){var e,n=t.world,i=n.height,o=n.width,r=t.shapeValues,a=t.momentum.vector,s=c({x:r.x+a.x,y:r.y+a.y,radius:r.radius});if(c(r).length,0===s.length)return null;var l={x:r.x,y:r.y};s.includes("BOTTOM")&&(l.y=i-r.radius,e=.5*Math.PI),s.includes("TOP")&&(l.y=r.radius,e=.5*Math.PI),s.includes("LEFT")&&(l.x=r.radius,e=.01*Math.PI),s.includes("RIGHT")&&(l.x=o-r.radius,e=.01*Math.PI);var u=new E(r.radius,t.momentum.direction).vector;return{type:"edge",wallAngle:e,impactPoint:{x:l.x+u.x,y:l.y+u.y},item1:t,item2:null,stopPoint:l,force:t.momentum.magnitude,force2:0};function c(t){var e=t.x,n=t.y,r=t.radius,a=[];return e-r<0&&a.push("LEFT"),e+r>o&&a.push("RIGHT"),n-r<0&&a.push("TOP"),n+r>i&&a.push("BOTTOM"),a}}function Y(t,e){if(t===e)return null;var n,i,o={x:t.momentum.vectorX,y:t.momentum.vectorY};if(n=o,i=[],isFinite(n.x)||i.push("x"),isFinite(n.y)||i.push("y"),i.length&&i)return console.log("bad vector for "+t.data.color+" "+t.data.shape.id+"in checkForCircleCollisions"),console.log(o),null;var r=t.mass&&t.momentum?t.mass*t.momentum.magnitude:0,a=e.mass&&e.momentum?e.mass*e.momentum.magnitude:r,s={x:t.data.x+o.x,y:t.data.y+o.y,circular:!0,radius:t.shapeValues.radius};if(t.isIntersectingWith(e)){var l={x:void 0,y:void 0},c={x:t.data.x,y:t.data.y};if(t.mass<=e.mass){var d=u(t.data,e.data);if(d){var h={x:t.data.x-e.data.x,y:t.data.y-e.data.y},f=E.fromVector(h.x,h.y).magnitude;l={x:h.x/f,y:h.y/f}}else l.x=Math.random(),l.y=1-l.x;var p=t.data.size+e.data.size-d;c.x+=l.x*p,c.y+=l.y*p}return{type:"start inside",impactPoint:{x:t.data.x,y:t.data.y},stopPoint:c,item1:t,item2:e,force:r,force2:a}}var y,m,g=v(t.shapeValues,s,e.shapeValues),x=u(e.shapeValues,g),b=x*x,w=Math.sqrt(Math.pow(t.shapeValues.radius+e.shapeValues.radius,2)-b),P=E.fromVector(o.x,o.y).magnitude,C={x:g.x+w*(-o.x/P),y:g.y+w*(-o.y/P)},O=E.fromVector(C.x-e.shapeValues.x,C.y-e.shapeValues.y).direction;return t.isIntersectingWith(e)?{type:"end inside",x:(m={x:C.x+s.radius*-Math.sin(O),y:C.y+s.radius*-Math.cos(O)}).x,y:m.y,impactPoint:m,stopPoint:C,item1:t,item2:e,force:r,force2:a}:x<=e.shapeValues.radius+s.radius&&(0!==o.x?(t.shapeValues.x<C.x&&C.x<s.x||t.shapeValues.x>C.x&&C.x>s.x)&&(y=!0):(t.shapeValues.y<C.y&&C.y<s.y||t.shapeValues.y>C.y&&C.y>s.y)&&(y=!0),y)?{type:"passed through",impactPoint:m={x:C.x+s.radius*-Math.sin(O),y:C.y+s.radius*-Math.cos(O)},stopPoint:C,item1:t,item2:e,force:r,force2:a}:null}function X(t,e){if(t===e)return null;var n=e.polygonPoints,o=t.shapeValues,r=t.momentum.vectorX,a=t.momentum.vectorY,s=t.mass&&t.momentum?t.mass*t.momentum.magnitude:0,l=e.mass&&e.momentum?e.mass*e.momentum.magnitude:s;if(b(o,n)){var u=N(o,n),d=void 0;if(P(o,n)){var p=c(u.point,o);d={x:u.point.x+h(o.radius+1,p),y:u.point.y+f(o.radius+1,p)}}else d={x:u.point.x+h(o.radius+1,u.edgeAngle-i),y:u.point.y+f(o.radius+1,u.edgeAngle-i)};return{type:"start inside",impactPoint:u.point,wallAngle:u.edgeAngle,stopPoint:d,item1:t,item2:e,force:s,force2:l}}var y={x:t.data.x+r,y:t.data.y+a,radius:t.data.size};if(b(y,n))return{type:"end inside",wallAngle:(m=U(t,e)).wallAngle,stopPoint:d=m.stopPoint,impactPoint:m.impactPoint,item1:t,item2:e,force:s,force2:l};var m,g=h(t.data.size,t.momentum.direction+i),v=f(t.data.size,t.momentum.direction+i);return w([{x:t.data.x+g,y:t.data.y+v},{x:t.data.x-g,y:t.data.y-v},{x:y.x-g,y:y.y-v},{x:y.x+g,y:y.y+v}],n)?{type:"passed through",wallAngle:(m=U(t,e)).wallAngle,stopPoint:d=m.stopPoint,impactPoint:m.impactPoint,item1:t,item2:e,force:s,force2:l}:null}function U(e,n){var i=a(n.polygonPoints),o=h(e.data.size,e.momentum.direction),r=f(e.data.size,e.momentum.direction),s=e.momentum.vectorX,l=e.momentum.vectorY,d=e.shapeValues,m=[{x:e.data.x,y:e.data.y},{x:e.data.x+2*o+s,y:e.data.y+l+2*r}],g=[];if(i.forEach((function(t,e){var n=k(t,m);null!==n&&g.push({edgeIndex:e,point:n,edge:t})})),g.length>0){var x=(g=g.sort((function(t,e){return u(t.point,d)-u(e.point,d)})))[0].point,b=g[0].edge,w=c.apply(t,b),P=Math.abs(e.momentum.direction-w),C=y(x,p(-d.radius/Math.sin(P),e.momentum.direction));return{stopPoint:C,impactPoint:v.apply(t,q(q([],b),[C])),wallAngle:w}}return console.warn("GLANCING HIT, NOT HANDLED"),{stopPoint:{x:e.data.x,y:e.data.x},impactPoint:{x:e.data.x,y:e.data.x},wallAngle:null}}function Z(t,e){if(t===e)return null;var n=t.mass&&t.momentum?t.mass*t.momentum.magnitude:0,o=e.mass&&e.momentum?e.mass*e.momentum.magnitude:n,r=t.polygonPoints,a=e.shapeValues;if(t.isIntersectingWith(e)){var s=N(a,r),l=void 0;if(P(a,r)){var u=c(s.point,a);l={x:s.point.x+h(a.radius+1,u)-a.x,y:s.point.y+f(a.radius+1,u)-a.y}}else l={x:s.point.x+h(a.radius+1,s.edgeAngle-i)-a.x,y:s.point.y+f(a.radius+1,s.edgeAngle-i)-a.y};return{type:"start inside",impactPoint:s.point,wallAngle:s.edgeAngle,stopPoint:y(t.data,l,!0),item1:t,item2:e,force:n,force2:o}}var d,p=t.duplicate();if(p.data.x+=p.momentum.vectorX,p.data.y+=p.momentum.vectorY,p.isIntersectingWith(e)){var m=(d=t,console.warn("GLANCING HIT, NOT HANDLED"),{stopPoint:{x:d.data.x,y:d.data.y},impactPoint:{x:d.data.x,y:d.data.y},wallAngle:null});return{type:"end inside",wallAngle:m.wallAngle,stopPoint:m.stopPoint,impactPoint:m.impactPoint,item1:t,item2:e,force:n,force2:o}}return null}H((function(){return null!==G&&G.apply(this,arguments)||this}),G=function(){});var J=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),K=function(t){function e(e){var n=t.call(this)||this;return n.id=e.id,n.getShapeValues=e.getShapeValues,n.getPolygonPoints=e.getPolygonPoints,n.containsPoint=e.containsPoint,n.intersectingWithShape=e.intersectingWithShape,n.renderOnCanvas=e.renderOnCanvas,n}return J(e,t),e}((function(){})),Q={circle:new K({id:"circle",getShapeValues:function(){var t=this;return{radius:t.data.size,x:t.data.x,y:t.data.y,top:t.data.y-t.data.size,bottom:t.data.y+t.data.size,left:t.data.x-t.data.size,right:t.data.x+t.data.size}},getPolygonPoints:function(){return[]},containsPoint:function(t){return u(this.data,t)<=this.data.size},intersectingWithShape:function(t){var e=this;if(t.isFluid)return b(e.shapeValues,t.polygonPoints);if(t.isBody)switch(t.data.shape.id){case"circle":return x(e.shapeValues,t.shapeValues);case"square":return b(e.shapeValues,t.polygonPoints);default:return!1}},renderOnCanvas:function(t,e,n){var i=e.data,o=i.color,r=void 0===o?"white":o,a=i.fillColor,s=i.heading;j(t,e.shapeValues,{strokeColor:r,fillColor:a,heading:s},n)}}),square:new K({id:"square",getShapeValues:function(){var t=this;return{radius:t.data.size,x:t.data.x,y:t.data.y,top:t.data.y-t.data.size,bottom:t.data.y+t.data.size,left:t.data.x-t.data.size,right:t.data.x+t.data.size}},getPolygonPoints:function(){var t=this.data,e=t.size,n=t.heading,o=this.shapeValues,r=o.x,a=o.y,s={x:r+h(e,n)+h(e,n+i),y:a+f(e,n)+f(e,n+i)},l={x:r+h(e,n)+h(e,n-i),y:a+f(e,n)+f(e,n-i)},u={x:r-h(e,n)+h(e,n+i),y:a-f(e,n)+f(e,n+i)};return[s,l,{x:r-h(e,n)+h(e,n-i),y:a-f(e,n)+f(e,n-i)},u]},containsPoint:function(t){return P(t,this.polygonPoints)},intersectingWithShape:function(t){var e=this;if(t.isFluid)return b(e.shapeValues,t.polygonPoints);if(t.isBody)switch(t.data.shape.id){case"square":w(t.polygonPoints,e.polygonPoints);case"circle":return b(t.shapeValues,e.polygonPoints);default:return!1}},renderOnCanvas:function(t,e,n){var i=e.data,o=i.color,r=void 0===o?"white":o,a=i.fillColor,s=i.heading,l=void 0===s?0:s,u=e.polygonPoints;I(t,u,{strokeColor:r,fillColor:a,heading:l},n)}})},$=function(){function t(t,e){void 0===e&&(e=E.none),this.data=t,this.data.heading=this.data.heading||0,this.data.density="number"==typeof this.data.density?this.data.density:1,this.data.size="number"==typeof this.data.size?this.data.size:1,this.data.shape=this.data.shape||Q.circle,this.data.headingFollowsDirection=t.headingFollowsDirection||!1,this.data.immobile=t.immobile||!1,this.data.renderHeadingIndicator=t.renderHeadingIndicator||!1,this.data.renderPathAhead=t.renderPathAhead||!1,this.data.elasticity="number"==typeof this.data.elasticity?this.data.elasticity:1,this.momentum=e||E.none}return Object.defineProperty(t.prototype,"isBody",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isFluid",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"typeId",{get:function(){return"Body"},enumerable:!1,configurable:!0}),t.prototype.duplicate=function(){return new(Object.getPrototypeOf(this).constructor)(Object.assign({},this.data),new E(this.momentum.magnitude,this.momentum.direction))},Object.defineProperty(t.prototype,"volume",{get:function(){var t=this.data.size;return 4/3*Math.pow(t,3)*Math.PI},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mass",{get:function(){var t=this.data.density;return this.volume*t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"polygonPoints",{get:function(){return this.data.shape.getPolygonPoints.apply(this,[])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shapeValues",{get:function(){return this.data.shape.getShapeValues.apply(this,[])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gravitationalForces",{get:function(){var t=this;if(!this.world)return E.none;var e=this.world,n=e.globalGravityForce,i=e.gravitationalConstant,o=e.bodies,r=e.bodiesExertGravity,a=e.minimumMassToExertGravity,s=[];if(r){var l=(a?o.filter((function(e){return e!==t&&e.mass>=a})):o.filter((function(e){return e!==t}))).map((function(e){return function(t,e,n){if(e===n)return E.none;if(e.isIntersectingWith(n))return E.none;var i=u(e.data,n.data),o=t*(e.mass*n.mass/Math.pow(i,2)),r=c(n.data,e.data);return new E(o,r)}(i,t,e)}));s.push.apply(s,l)}if(n){var d=new E(n.magnitude*i*this.mass,n.direction);s.push(d)}return E.combine(s)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"upthrustForces",{get:function(){var t=this;if(!this.world)return E.none;var e=this.world,n=e.gravitationalConstant,i=e.fluids,o=e.globalGravityForce,r=[];return i.forEach((function(e){t.isIntersectingWith(e)&&r.push(function(t,e,n,i){if(!e)return E.none;var o=n.shapeValues,r=i.surfaceLevel-o.top,a=r<0?0:Math.PI*Math.pow(r,2)/3*(3*o.radius-r),s=o.bottom-i.bottomLevel,l=s<0?0:Math.PI*Math.pow(s,2)/3*(3*o.radius-s),u=n.volume-a-l,c=t*e.magnitude*i.data.density*u;return new E(c,e.direction+Math.PI)}(n,o,t,e))})),E.combine(r)},enumerable:!1,configurable:!0}),t.prototype.enterWorld=function(t){this.world&&this.leaveWorld(),t.bodies.push(this),this.world=t},t.prototype.leaveWorld=function(){this.world&&this.world.bodiesLeavingAtNextTick.push(this)},t.prototype.updateMomentum=function(){var t=this,e=t.gravitationalForces,n=t.mass,i=t.upthrustForces;if(this.data.immobile)this.momentum=E.none;else{e.magnitude=e.magnitude/n,i.magnitude=i.magnitude/n;var o=function(t,e){if(!t.world)return E.none;var n=t.world,i=n.fluids,o=n.airDensity;if(0==i.length&&0==o)return E.none;var r=Math.pow(t.shapeValues.radius,2)*Math.PI,a=e.magnitude,s=null;i.forEach((function(e){P(t.shapeValues,e.polygonPoints)&&(s=e)}));var l,u=(void 0===l&&(l=1),.5*(s?s.data.density:o)*(2*a)*l*r/t.mass);return new E(Math.min(u,a),e.direction+Math.PI)}(this,E.combine([this.momentum,e,i]));this.momentum=E.combine([this.momentum,e,i,o])}},t.prototype.move=function(){var t=this,e=this.duplicate(),n=e.shapeValues,i=n.top,o=n.bottom,r=n.radius,a=n.left,s=n.right;this.data.immobile||(e.data.y+=e.momentum.vectorY,e.data.x+=e.momentum.vectorX);var l=this.world.bodies.filter((function(e){return e.data.immobile&&e!==t})),u=0;for(u=0;u<l.length;u++)e.isIntersectingWith(l[u])&&(e.data.x=this.data.x,e.data.y=this.data.y);this.world.hasHardEdges&&!this.data.immobile&&(e.data.y=i<0?r:e.data.y,e.data.y=o>this.world.height?this.world.height-r:e.data.y,e.data.x=a<0?r:e.data.x,e.data.x=s>this.world.width?this.world.width-r:e.data.x),this.data.headingFollowsDirection&&(e.data.heading=e.momentum.direction),this.data.x=e.data.x,this.data.y=e.data.y,this.data.heading=e.data.heading},t.prototype.detectCollisions=function(t,e){var n=this;void 0===t&&(t=!0),void 0===e&&(e=!0);var i=this.world.bodies.filter((function(i){return i!==n&&(t||i.data.immobile)&&(e||!i.data.immobile)})),o=this.momentum,r=o.vectorX,a=o.vectorY,s=this.data,l=s.x,u=s.y,c=1.5*this.data.size+2*Math.abs(a),d=1.5*this.data.size+2*Math.abs(r),h=i.filter((function(t){return Math.abs(t.data.y-u)<c+1.5*t.data.size&&Math.abs(t.data.x-l)<d+1.5*t.data.size})),f=[];return h.forEach((function(t){var e=function(t,e){switch(t.id+"-"+e.id){case"circle-circle":return Y;case"circle-square":return X;case"square-circle":return Z;case"square-square":default:return function(){return null}}}(n.data.shape,t.data.shape)(n,t);f.push(e)})),f},t.prototype.handleCollision=function(t){B(t)},t.prototype.detectWorldEdgeCollisions=function(){if(!this.world)return[];var t=[],e=function(t){switch(t.id){case"circle":case"square":default:return R}}(this.data.shape);return t.push(e(this)),t},t.prototype.handleWorldEdgeCollision=function(t){var e,n,i;n=(e=t).item1,i=e.stopPoint,n.data.x=i.x,n.data.y=i.y,e.item1.momentum=function(t){var e=t.item1,n=t.wallAngle;return new E(e.momentum.magnitude*e.data.elasticity,M(e.momentum.direction,n))}(e)},t.prototype.renderOnCanvas=function(t,e){this.data.renderPathAhead&&function(t,e,n){var o=h(e.data.size,e.momentum.direction+i),r=f(e.data.size,e.momentum.direction+i),a=[{x:e.data.x+o,y:e.data.y+r},{x:e.data.x-o,y:e.data.y-r},{x:e.data.x+e.momentum.vectorX-o,y:e.data.y+e.momentum.vectorY-r},{x:e.data.x+e.momentum.vectorX+o,y:e.data.y+e.momentum.vectorY+r}].map((function(t){return n.mapPoint(t)}));t.beginPath(),t.fillStyle="yellow",t.moveTo(a[0].x,a[0].y);for(var s=1;s<a.length;s++)t.lineTo(a[s].x,a[s].y);t.lineTo(a[0].x,a[0].y),t.fill()}(t,this,e),this.data.shape.renderOnCanvas(t,this,e),this.data.renderHeadingIndicator&&function(t,e,n){var i=e.data,o=i.size,r=i.heading,a=e.shapeValues,s=a.x,l=a.y,u=n.mapPoint(e.shapeValues),c=n.mapPoint({x:s+h(o,r),y:l+f(o,r)});t.beginPath(),t.lineWidth=n.visibleLineWidth,t.strokeStyle="yellow",t.moveTo(u.x,u.y),t.lineTo(c.x,c.y),t.stroke(),t.lineWidth=1}(t,this,e)},t.prototype.checkIfContainsPoint=function(t){return this.data.shape.containsPoint.apply(this,[t])},t.prototype.isIntersectingWith=function(t){return this.data.shape.intersectingWithShape.apply(this,[t])},t}(),tt=(function(){function t(t){this.data=t,this.data.drainRate=t.drainRate||0}Object.defineProperty(t.prototype,"isFluid",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isBody",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"typeId",{get:function(){return"Fluid"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depth",{get:function(){return this.world?this.data.volume/this.world.width:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"surfaceLevel",{get:function(){return this.world?this.bottomLevel-this.depth:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottomLevel",{get:function(){var t=this;if(!this.world)return 0;var e=this.world.fluids.filter((function(e){return e!==t&&e.data.density>=t.data.density})).sort((function(t,e){return e.data.density-t.data.density})).reduce((function(t,e){return t+e.depth}),0);return this.world.height-e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"polygonPoints",{get:function(){return this.world?[{x:0,y:this.bottomLevel},{x:0,y:this.surfaceLevel},{x:this.world.width,y:this.surfaceLevel},{x:this.world.width,y:this.bottomLevel}]:[]},enumerable:!1,configurable:!0}),t.prototype.enterWorld=function(t){this.world&&this.leaveWorld(),t.fluids.push(this),this.world=t},t.prototype.leaveWorld=function(){this.world&&(-1!==this.world.fluids.indexOf(this)&&this.world.fluids.splice(this.world.fluids.indexOf(this),1),this.world=null)},t.prototype.drain=function(){this.data.volume=this.data.volume-this.data.drainRate,this.data.volume<0&&(this.data.volume=0)},t.prototype.renderOnCanvas=function(t,e){I(t,this.polygonPoints,{fillColor:this.data.color},e)}}(),function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}()),et=function(t){function e(e){var n=t.call(this,e)||this;return n.size=e.size||100,n.color=e.color||"red",n}return tt(e,t),Object.defineProperty(e.prototype,"typeId",{get:function(){return"ExpandingRing"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this.size*(this.frame/this.duration)},enumerable:!1,configurable:!0}),e.prototype.renderOnCanvas=function(t,e){j(t,this,{strokeColor:this.color},e)},e}(function(){function t(t){this.x=t.x,this.y=t.y,this.heading=t.heading,this.color=t.color,this.frame=t.frame||0,this.duration=t.duration||100}return Object.defineProperty(t.prototype,"typeId",{get:function(){return"Effect"},enumerable:!1,configurable:!0}),t.prototype.enterWorld=function(t){this.world&&this.leaveWorld(),t.effects.push(this),this.world=t},t.prototype.leaveWorld=function(){this.world&&this.world.effects.splice(this.world.effects.indexOf(this),1)},t.prototype.tick=function(){this.frame++,this.frame>=this.duration&&this.leaveWorld()},t.prototype.renderOnCanvas=function(t,e){var n=this,i=n.x,o=n.y,r=n.color;j(t,{x:i,y:o,radius:10},{fillColor:void 0===r?"red":r},e)},t}()),nt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),it=(function(t){function e(e){var n=t.call(this,e)||this;return n.body=e.body,n.followHeading=e.followHeading||!1,n.magnify=e.magnify||1,n.leadDistance=e.leadDistance||0,n}nt(e,t),e.prototype.focusViewPort=function(t){if(t.world.bodies.includes(this.body)){var e={x:this.body.data.x,y:this.body.data.y};if(this.leadDistance){var n=new E(this.leadDistance/this.magnify,this.body.data.heading);e.x+=n.vectorX,e.y+=n.vectorY}this.followHeading&&(t.rotate=C(2*i-this.body.data.heading)),t.focusOn(e,!1,this.magnify)}}}(function(){function t(t){}return t.prototype.focusViewPort=function(t){},t}()),function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}()),ot=function(){function t(){}return t.prototype.tick=function(){},t.prototype.renderOnCanvas=function(t,e){},t}(),rt=function(t){function e(e){var n=t.call(this)||this,i=e.width,o=e.height,r=e.depth;n.stars=[];for(var a=i/2,s=o/2,l=0;l<e.numberOfStars;l++)n.stars.push({x:a+Math.floor(Math.random()*i*r)-i/2*r,y:s+Math.floor(Math.random()*o*r)-o/2*r,depth:r});return n}return it(e,t),e.prototype.renderOnCanvas=function(t,e){this.stars.forEach((function(n){!function(n){!function(t,e,n,i){_(t,n);var o=i.mapPoint(e,n.parallax);t.arc(o.x,o.y,Math.round(i.pointRadius/2),0,2*Math.PI),n.fillColor&&t.fill(),n.strokeColor&&t.stroke()}(t,n,{fillColor:"white",parallax:n.depth},e)}(n)}))},e}(ot),at=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),st=function(){function t(t){this.fallbackColor=t.fallbackColor,this.makeCanvasFill=t.canvasFunction}return t.prototype.setFillStyleForCircle=function(t,e,n,i){n.fillStyle=this.fallbackColor},t.prototype.setFillStyleForPolygon=function(t,e,n,i){n.fillStyle=this.fallbackColor},t.prototype.setFillStyleForViewPort=function(t,e){t.fillStyle=this.fallbackColor},Object.defineProperty(t.prototype,"isFillColorObject",{get:function(){return!0},enumerable:!1,configurable:!0}),t}(),lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return at(e,t),e.prototype.setFillStyleForCircle=function(t,e,n,i){var o=h(t.radius,e),r=f(t.radius,e),a=[{x:t.x+o,y:t.y+r},{x:t.x-o,y:t.y-r}].map((function(t){return i.mapPoint(t)}));n.fillStyle=this.makeCanvasFill(n,a)},e.prototype.setFillStyleForPolygon=function(t,e,n,i){var o=a(t),r={x:(o[0][0].x+o[0][1].x)/2,y:(o[0][0].y+o[0][1].y)/2},s=Math.floor(o.length/2),l=[r,{x:(o[s][0].x+o[s][1].x)/2,y:(o[s][0].y+o[s][1].y)/2}].map((function(t){return i.mapPoint(t)}));n.fillStyle=this.makeCanvasFill(n,l)},e.prototype.setFillStyleForViewPort=function(t,e){t.fillStyle=this.makeCanvasFill(t,[{x:e.width/2,y:0},{x:e.width/2,y:e.height}])},e}(st),ut=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return at(e,t),e.prototype.setFillStyleForCircle=function(t,e,n,i){var o=i.mapPoint(t),r={x:o.x,y:o.y,radius:t.radius*i.magnify};n.fillStyle=this.makeCanvasFill(n,r,e)},e.prototype.setFillStyleForPolygon=function(t,e,n,i){var o={x:t.reduce((function(t,e){return e.x+t}),0)/t.length,y:t.reduce((function(t,e){return e.y+t}),0)/t.length},r=t.map((function(t){return u(t,o)})).sort().reverse()[0],a=i.mapPoint(o),s={x:a.x,y:a.y,radius:r*i.magnify};n.fillStyle=this.makeCanvasFill(n,s,e)},e.prototype.setFillStyleForViewPort=function(t,e){var n={x:e.width/2,y:e.height/2,radius:Math.max(e.width/2,e.height/2)};t.fillStyle=this.makeCanvasFill(t,n,0)},e}(st),ct=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),dt=function(t){function e(e){var n=t.call(this,e)||this;return n.isFromPlayer=e.isFromPlayer||!1,n.fillColor=e.fillColor||"transparent",n}return ct(e,t),Object.defineProperty(e.prototype,"typeId",{get:function(){return"Explosion"},enumerable:!1,configurable:!0}),e.prototype.renderOnCanvas=function(t,e){j(t,this,{strokeColor:this.color,fillColor:this.fillColor},e)},e.prototype.tick=function(){var t=this;et.prototype.tick.apply(this,[]),this.world.bodies.filter((function(t){return"Bomb"==t.typeId})).forEach((function(e){x(t,e.shapeValues)&&(e.explode(t.isFromPlayer),t.isFromPlayer&&e.reportPoints(10))})),this.isFromPlayer||this.world.bodies.filter((function(t){return"MissileSilo"==t.typeId||"Building"==t.typeId})).forEach((function(e){x(t,e.shapeValues)&&(e.data.isDestroyed=!0)}))},e}(et),ht=new ut({fallbackColor:"transparent",canvasFunction:function(t,e,n){var i={x:e.x,y:e.y,radius:e.radius*(1/3)},o=t.createRadialGradient(i.x,i.y,i.radius,e.x,e.y,e.radius);return o.addColorStop(0,"transparent"),o.addColorStop(.1,"white"),o.addColorStop(.2,"yellow"),o.addColorStop(1,"red"),o}}),ft=new ut({fallbackColor:"transparent",canvasFunction:function(t,e,n){var i={x:e.x,y:e.y,radius:e.radius*(1/3)},o=t.createRadialGradient(i.x,i.y,i.radius,e.x,e.y,e.radius);return o.addColorStop(0,"transparent"),o.addColorStop(.1,"white"),o.addColorStop(.3,"blue"),o.addColorStop(1,"cyan"),o}});function pt(t){var e=new lt({fallbackColor:t[t.length-1][1],canvasFunction:function(e,n){var i=e.createLinearGradient(n[0].x,n[0].y,n[1].x,n[1].y);return t.forEach((function(t){i.addColorStop.apply(i,t)})),i}}),n=new ot;return n.renderOnCanvas=function(t,n){I(t,n.worldCorners,{fillColor:e},n)},n}var yt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),mt=function(t){function e(e,n){void 0===n&&(n=null);var i=t.call(this,e,n)||this;return i.data.headingFollowsDirection=!0,i}return yt(e,t),Object.defineProperty(e.prototype,"typeId",{get:function(){return"Bomb"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scoreValue",{get:function(){return 10},enumerable:!1,configurable:!0}),e.prototype.handleCollision=function(t){var e=t.item1===this?t.item2:t.item1;"Bomb"!==e.typeId?(this.explode(),"Missile"===e.typeId&&(e.explode,this.reportPoints(this.scoreValue))):$.prototype.handleCollision(t)},e.prototype.explode=function(t){void 0===t&&(t=!1),this.leaveWorld(),new dt({x:this.data.x,y:this.data.y,size:150,duration:15,color:t?"red":"darkorange",fillColor:t?ht:ft,isFromPlayer:t}).enterWorld(this.world)},e.prototype.reportPoints=function(t){this.world&&this.world.emitter.emit("points",t)},e.prototype.move=function(){$.prototype.move.apply(this,[]),this.data.y>this.world.height+200&&this.leaveWorld()},e.prototype.renderOnCanvas=function(t,e){var n=this.shapeValues,o=this.data,r=o.heading,a=o.size,s=.6*a,l=2*a,u=y(n,p(a+s,O(r))),c=y(n,p(s/2,r+i)),d=y(y(c,p(l,O(r))),p(s,r+i)),h=y(n,p(s/2,r-i)),f=y(y(h,p(l,O(r))),p(s,r-i));I(t,[c,d,u,f,h],{fillColor:"gray",strokeColor:"white"},e),F(t,Object.assign({heading:r,angle:2*i},n),{fillColor:"crimson",strokeColor:"white"},e),F(t,Object.assign({heading:O(r),angle:2*i},n),{fillColor:"gray",strokeColor:"white"},e)},e}($),gt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),vt=function(t){function e(n){var i=t.call(this,n)||this;return i.data.immobile=!0,i.data.shape=Q.square,i.data.isDestroyed=n.isDestroyed||!1,i.data.ruinPatterIndex=n.ruinPatterIndex||Math.floor(Math.random()*e.ruinPatterns.length),i.data.buildingPatternIndex=n.buildingPatternIndex||Math.floor(Math.random()*e.buildingPatterns.length),i}return gt(e,t),Object.defineProperty(e.prototype,"typeId",{get:function(){return"Building"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scoreValue",{get:function(){return 100},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ruinPolygon",{get:function(){var t=this.shapeValues,n=t.top,i=t.left,o=t.radius;return e.ruinPatterns[this.data.ruinPatterIndex].map((function(t){return{x:i+o*t[0],y:n+o*t[1]}}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buildingPolygon",{get:function(){var t=this.shapeValues,n=t.top,i=t.left,o=t.radius;return e.buildingPatterns[this.data.buildingPatternIndex].map((function(t){return{x:i+o*t[0],y:n+o*t[1]}}))},enumerable:!1,configurable:!0}),e.prototype.renderOnCanvas=function(t,e){this.data.isDestroyed?I(t,this.ruinPolygon,{fillColor:this.data.fillColor,strokeColor:this.data.color},e):(this.data.shape.renderOnCanvas(t,this,e),I(t,this.buildingPolygon,{fillColor:this.data.fillColor,strokeColor:this.data.color},e))},Object.defineProperty(e,"ruinPatterns",{get:function(){return[[[0,2],[0,0],[.3,0],[.5,1.4],[.6,1.3],[.7,.6],[1.2,.4],[1.8,.1],[2,.1],[2,2]],[[0,2],[0,1.5],[.3,1.8],[.6,1.8],[.6,1.3],[1.1,1.6],[1.7,.4],[1.8,.4],[2,.1],[2,2]]]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"buildingPatterns",{get:function(){return[[[.2,.2],[1.8,.2],[1.8,.5],[.2,.5]],[[1.2,1.5],[.2,1.5],[.2,1],[1.2,1]],[[1,.5],[1,1.5],[1.5,1.5],[1.5,1],[.5,1],[.5,.5]]]},enumerable:!1,configurable:!0}),e}($),xt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),bt=h,wt=f,Pt=O,Ct=function(t){function e(e,n){void 0===n&&(n=null);var i=t.call(this,e,n)||this;return i.data.color=e.color||"red",i.data.fillColor=e.fillColor||"white",i.data.thrust=e.thrust||0,i.data.maxThrust=e.maxThrust||100,i.data.target=e.target||null,i.data.hasExplodedAlready=e.hasExplodedAlready||!1,i.data.explosionDuration=e.explosionDuration||10,i.data.explosionSize=e.explosionSize||100,i}return xt(e,t),Object.defineProperty(e.prototype,"typeId",{get:function(){return"Missile"},enumerable:!1,configurable:!0}),e.prototype.move=function(){$.prototype.move.apply(this,[]),this.shapeValues.y<this.data.target.y&&this.explode()},e.prototype.renderOnCanvas=function(t,e){var n=this.data,i=n.x,o=n.y,r=n.size,a=n.heading,s=n.color,l=n.fillColor,u=n.thrust,c=n.maxThrust,d={x:i+bt(r,a),y:o+wt(r,a)},h=.75*Math.PI,f={x:i+bt(r,a-h),y:o+wt(r,a-h)},p={x:i+bt(r,a+h),y:o+wt(r,a+h)};if(I(t,[d,f,p],{strokeColor:s,fillColor:l},e),u>0){var y={x:i-bt(r,a),y:o-wt(r,a)},m=.5*(Math.random()-.5),g={x:y.x+bt(r*(u/c)*2,Pt(a+m)),y:y.y+wt(r*(u/c)*2,Pt(a+m))};I(t,[p,g,f],{strokeColor:"blue",fillColor:"green"},e)}},e.prototype.changeThrottle=function(t){var e=this.data.thrust+t;e<0&&(e=0),e>this.data.maxThrust&&(e=this.data.maxThrust),this.data.thrust=e},e.prototype.updateMomentum=function(){$.prototype.updateMomentum.apply(this,[]);var t=this.data,e=t.thrust,n=t.heading,i=new E(e/this.mass,n);this.momentum=E.combine([this.momentum,i])},e.prototype.explode=function(){var t=this.data,e=t.hasExplodedAlready,n=t.explosionSize,i=t.explosionDuration,o=t.x,r=t.y;e||(this.leaveWorld(),this.data.hasExplodedAlready=!0,new dt({x:o,y:r,duration:i,size:n,color:"red",fillColor:ht,isFromPlayer:!0}).enterWorld(this.world))},e.prototype.handleCollision=function(t){var e=t.item1===this?t.item2:t.item1;"Bomb"===e.typeId?(this.explode(),e.explode):$.prototype.handleCollision(t)},e}($),Ot=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Mt=function(t){function e(e){var n=t.call(this,e)||this;return n.data.shape=Q.circle,n.data.elasticity=.1,n.data.immobile=!0,n.data.isDestroyed=e.isDestroyed||!1,n}return Ot(e,t),Object.defineProperty(e.prototype,"typeId",{get:function(){return"MissileSilo"},enumerable:!1,configurable:!0}),e.prototype.launchMissle=function(t){if(!(t.y>this.shapeValues.top)){var e=c(t,this.shapeValues),n=y(this.shapeValues,p(this.shapeValues.radius+10,e));new Ct({x:n.x,y:n.y,heading:e,target:t,explosionDuration:20,explosionSize:200,thrust:2e4,maxThrust:2e4,density:.2,size:15}).enterWorld(this.world)}},e.prototype.renderOnCanvas=function(t,e){var n=this.shapeValues,i=this.data,o=n.x,r=n.y,a=n.radius,s=[{x:o-a,y:r+1*a/4},{x:o+a,y:r+1*a/4},{x:o+a,y:r},{x:o+1*a/3,y:r-1*a/4},{x:o-1*a/3,y:r-1*a/4},{x:o-a,y:r}];if(!i.isDestroyed){var l=[n,y(n,p(a,i.heading))],u={x:l[1].x,y:l[1].y,radius:a*(1/8)};(function(t,e,n,i){_(t,n);var o=n.parallax,r=void 0===o?1:o,a=e.map((function(t){return i.mapPoint(t,r)}));t.moveTo(a[0].x,a[0].y),t.lineTo(a[1].x,a[1].y),n.strokeColor&&t.stroke()})(t,l,{strokeColor:i.color,lineWidth:4},e),j(t,u,{strokeColor:i.color},e)}I(t,s,{strokeColor:i.color,fillColor:i.fillColor},e)},e}($),St=function(t){this.duration=t.duration,this.contents=t.contents,this.height=t.height,this.width=t.width,this.gravity=t.gravity||1,this.airDensity=t.airDensity||.1,this.bombWaveFunction=t.bombWaveFunction,this.backgrounds=t.backgrounds||[]},kt=function(t,e){for(var n=0,i=e.length,o=t.length;n<i;n++,o++)t[o]=e[n];return t},Et=pt([[.2,"black"],[.8,"skyblue"]]),_t=pt([[.2,"black"],[.9,"purple"]]),Tt=pt([[.1,"black"],[.5,"darkgoldenrod"],[.8,"darkgoldenrod"],[.9,"skyblue"]]),jt=new rt({numberOfStars:50,depth:1,height:600,width:6e3}),Ft=new rt({numberOfStars:25,depth:1,height:800,width:7e3});function It(t,e,n){return new Mt({fillColor:"blue",color:"red",x:n*t,y:e-37.5,size:150,heading:Math.PI})}function Vt(t,e,n,i){return[new Mt({fillColor:"blue",color:"red",x:n*t,y:e-37.5-2*i,size:Math.min(150,i),heading:Math.PI}),new $({shape:Q.square,x:n*t,y:e-i,size:i,immobile:!0,fillColor:"blue",color:"red"})]}function At(t,e,n,i){return new vt({size:e,y:n-e,x:i*t,fillColor:"grey",color:"white"})}function Lt(t,e,n){return void 0===n&&(n="brown"),new $({shape:Q.square,x:e/2,y:t+e/2,size:e/2,elasticity:.1,immobile:!0,fillColor:n,heading:Math.PI})}var Wt=[new St({duration:600,contents:kt(kt([At(1/8,100,2900,4e3)],Vt(2/8,2900,4e3,100)),[At(3/8,80,2900,4e3),It(6/8,2900,4e3),At(7.5/8,100,2900,4e3),Lt(2900,4e3,"green")]),backgrounds:[Et,jt],height:3e3,width:4e3,gravity:.8,bombWaveFunction:function(t){return t%200==0?Math.min(Math.floor(2+t/400),15):0}}),new St({duration:1e3,contents:[It(.5,2800,4e3),At(1/8,100,2800,4e3),At(3/8,80,2800,4e3),At(7.5/8,100,2800,4e3),Lt(2800,4e3,"red")],backgrounds:[_t],height:3e3,width:4e3,bombWaveFunction:function(t){return t%150==0?Math.min(Math.floor(2.5+t/400),15):0}}),new St({duration:1200,contents:kt(kt(kt(kt([At(1/8,100,4700,6e3)],Vt(2/8,4700,6e3,180)),[At(3/8,80,4700,6e3),At(5/8,80,4700,6e3)]),Vt(6/8,4700,6e3,180)),[At(7.5/8,100,4700,6e3),Lt(4700,6e3,"brown")]),height:5e3,width:6e3,airDensity:.01,gravity:.5,backgrounds:[jt],bombWaveFunction:function(t){return t%150==0?Math.min(Math.floor(4+t/300),18):0}}),new St({duration:1500,contents:[At(.5/8,100,4700,7e3),At(1/8,100,4700,7e3),It(2/8,4700,7e3),At(3/8,80,4700,7e3),At(4.5/8,110,4700,7e3),At(5/8,80,4700,7e3),It(6/8,4700,7e3),At(7.5/8,100,4700,7e3),Lt(4700,7e3,"black")],height:5e3,width:7e3,airDensity:.02,gravity:.4,backgrounds:[Tt,Ft],bombWaveFunction:function(t){return t%100==0?Math.min(Math.floor(3+t/200),18):0}})],zt=function(){function t(t,e,n){void 0===n&&(n={}),this.canvas=t,this.elements=e,this.handleClick=this.handleClick.bind(this),this.handleMousemove=this.handleMousemove.bind(this),this.handleTick=this.handleTick.bind(this),this.handlePoints=this.handlePoints.bind(this),this.frameFill=n.frameFill||"white",this.elements.pauseButton&&this.elements.pauseButton.addEventListener("click",this.togglePause.bind(this)),this.elements.resetButton&&this.elements.resetButton.addEventListener("click",this.reset.bind(this)),this.score=0,this.levelNumber=1,this.setStatusPrelevel()}return Object.defineProperty(t.prototype,"currentLevel",{get:function(){return Wt[this.levelNumber-1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentLevelIsFinished",{get:function(){if(!this.world)return!1;var t=this.world.bodies.find((function(t){return"Bomb"===t.typeId})),e=this.world.effects.find((function(t){return"Explosion"===t.typeId}));return"PLAY"===this.status&&!t&&!e&&this.tickCount>this.currentLevel.duration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playerHasLost",{get:function(){if(!this.world)return!1;var t=this.world.bodies.find((function(t){return"MissileSilo"===t.typeId&&!t.data.isDestroyed})),e=this.world.bodies.find((function(t){return"Building"===t.typeId&&!t.data.isDestroyed}));return!("PLAY"!==this.status||t&&e)},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this.removeEventHandlers(),this.viewPort.world&&this.viewPort.unsetWorld(),this.score=0,this.levelNumber=1,this.setStatusPrelevel()},t.prototype.setStatusPlay=function(){this.status="PLAY",this.setCaption()},t.prototype.setStatusGameOver=function(){this.status="GAMEOVER",this.setCaption("GAME OVER")},t.prototype.setStatusPostlevel=function(){var t=this.world.bodies.filter((function(t){return"Building"===t.typeId&&!1===t.data.isDestroyed})),e=t.reduce((function(t,e){return t+e.scoreValue}),0);this.handlePoints(e),this.status="POSTLEVEL",this.setCaption("\n        <p>Level "+this.levelNumber+" cleared</p> \n        <p>"+t.length+"x buildings left: "+e+" points</p> \n        <p></p>\n        ")},t.prototype.setStatusPrelevel=function(){var t;this.tickCount=-1,this.world=(t=this.currentLevel,new z(t.contents.map((function(t){return t.duplicate()})),{width:t.width,height:t.height,globalGravityForce:new E(t.gravity,0),gravitationalConstant:.125,airDensity:t.airDensity,backGrounds:t.backgrounds})),this.viewPort=V.fitToSize(this.world,this.canvas,750,500),this.viewPort.framefill=this.frameFill,this.applyEventHandlers(),this.world.ticksPerSecond=50,this.renderScore(),this.elements.level&&(this.elements.level.innerHTML=this.levelNumber.toString()),this.status="PRELEVEL",this.setCaption("\n        <p>Level "+this.levelNumber+"</p> \n        <p>Gravity "+this.currentLevel.gravity+"g</p>\n        <p>Atmosphere "+this.currentLevel.airDensity+"</p>\n        ")},t.prototype.setStatusPause=function(){"PLAY"===this.status&&this.world&&(this.status="PAUSE",this.setCaption("paused"),this.world.ticksPerSecond=0)},t.prototype.unpauseGame=function(){"PAUSE"===this.status&&this.world&&(this.setStatusPlay(),this.world.ticksPerSecond=50)},t.prototype.goToNextLevel=function(){this.levelNumber<Wt.length?this.levelNumber++:this.levelNumber=1,this.removeEventHandlers(),this.viewPort.world&&this.viewPort.unsetWorld(),this.setStatusPrelevel()},t.prototype.applyEventHandlers=function(){this.canvas.addEventListener("click",this.handleClick),this.canvas.addEventListener("mousemove",this.handleMousemove),this.world.emitter.on("tick",this.handleTick),this.world.emitter.on("points",this.handlePoints)},t.prototype.removeEventHandlers=function(){this.canvas.removeEventListener("click",this.handleClick),this.canvas.removeEventListener("mousemove",this.handleMousemove),this.world.emitter.off("tick",this.handleTick),this.world.emitter.off("points",this.handlePoints)},t.prototype.togglePause=function(){"PAUSE"==this.status?this.unpauseGame():"PLAY"==this.status&&this.setStatusPause()},t.prototype.renderScore=function(){if(this.elements.score){for(var t=this.score.toString(),e="",n=0;n<5-t.length;n++)e+="0";this.elements.score.innerHTML=e+t}},t.prototype.handlePoints=function(t){this.score+=t,this.renderScore()},t.prototype.handleClick=function(t){var e=this.viewPort.locateClick(t,!1);if(e)switch(this.status){case"PLAY":return this.fireNearestSilo(e);case"PAUSE":return this.unpauseGame();case"GAMEOVER":return this.reset();case"PRELEVEL":return this.setStatusPlay();case"POSTLEVEL":return this.goToNextLevel()}},t.prototype.handleMousemove=function(t){if("PLAY"===this.status){var e=this.viewPort.locateClick(t,!1);e&&this.aimSilos(e)}},t.prototype.setCaption=function(t){void 0===t&&(t=""),this.elements.caption&&(this.elements.caption.innerHTML=t,this.elements.caption.style.display=t?"":"none")},t.prototype.handleTick=function(){if(this.tickCount<=this.currentLevel.duration&&this.tickCount>=0){var t=this.currentLevel.bombWaveFunction(this.tickCount);this.addRandomBombs(t)}if(this.playerHasLost&&"PLAY"==this.status&&this.setStatusGameOver(),this.currentLevelIsFinished&&!this.playerHasLost&&"PLAY"==this.status)return this.setStatusPostlevel();"PLAY"==this.status&&this.tickCount++},t.prototype.aimSilos=function(t){this.world.bodies.filter((function(t){return"MissileSilo"===t.typeId})).forEach((function(e){t.y>e.shapeValues.top||(e.data.heading=c(t,e.shapeValues))}))},t.prototype.fireNearestSilo=function(t){if(this.world.bodies.find((function(t){return"Bomb"===t.typeId}))||!(this.tickCount>this.currentLevel.duration)){var e=this.world.bodies.filter((function(t){return"MissileSilo"===t.typeId})).filter((function(t){return!t.data.isDestroyed})).sort((function(e,n){return u(e.shapeValues,t)-u(n.shapeValues,t)}))[0];e&&e.launchMissle(t)}},t.prototype.addRandomBombs=function(t){var e,n,o,r=0,a=30,s=i,l=s/2;for(r=0;r<t;r++)e=Math.random()*this.world.width*.8+.1*this.world.width,n=Math.random()*s-l,o=10*Math.random(),a=Math.random()>.5?30:45,new mt({x:e,y:0,size:a,density:.1},new E(o,n)).enterWorld(this.world)},t}(),Dt=n(379),Bt=n.n(Dt),Gt=n(426);Bt()(Gt.Z,{insert:"head",singleton:!1}),Gt.Z.locals;var Ht=document.querySelector("canvas"),qt={pauseButton:document.querySelector("#pauseButton"),resetButton:document.querySelector("#resetButton"),score:document.querySelector("#score"),level:document.querySelector("#level"),caption:document.querySelector("#caption")};window.game=new zt(Ht,qt,{frameFill:"antiquewhite"})})()})();